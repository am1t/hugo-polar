{{ $link_text := $.Site.Params.reply_by_email_link_text }}
{{ $show_title := $.Site.Params.reply_by_email_show_title }}
{{ $show_plain := $.Site.Params.reply_by_email_show_plain }}
{{ $email_address := $.Site.Params.reply_by_email_address }}
{{ $email_address_present := in $email_address "@" }}
{{ $subject := $.Site.Params.reply_by_email_subject_prefix }}
{{ $enable_obfuscation := $.Site.Params.reply_by_email_enable_obfuscation }}

{{ if (and .Title $show_title) }}
{{ $subject = print $subject .Title }}
{{ else if (and (not .Title) .Plain $show_plain) }}
{{ $subject = (print $subject (replaceRE "(\\s)" " " .Plain)) | htmlUnescape | truncate 60 }}
{{ else }}
{{ $subject = print $subject .Permalink }}
{{ end }}
{
	"version": "https://jsonfeed.org/version/1",
	"title": "Excursions by Amit Gawande",
	"icon": "{{ .Site.Author.avatar }}",
	"home_page_url": "{{ .Site.BaseURL }}",
	"feed_url": "{{ .Site.BaseURL }}feed.json",
	"items": [
		{{- $list := first 25 (where .Site.Pages "Type" "post") -}}
		{{- $len := (len $list) -}}
		{{ range $index, $value := $list }}
			{
				{{ if .Params.guid -}}
				"id": "{{ .Params.guid }}",
				{{- else -}}
				"id": "{{ .Permalink }}",
				{{- end }}
				{{ if .Title -}}
				"title": {{ .Title | jsonify }},
				{{- end -}}
				{{- $s := .Content | jsonify -}}
				{{- $s := replace $s "\\u003c" "<" -}}
				{{- $s := replace $s "\\u003e" ">" -}}
				{{- $s := replace $s "\\u0026" "&" }}
				{{ $comment := "<p><p><a href='{{ .Permalink }}#commento'>Comment</a> or <a href='mailto:{{ $email_address }}?subject={{ $subject }}'>Reply via Email</a></p></p>" }}
				{{ $content_html := printf "%s\n%s" $s $comment }}
				"content_html": {{ $content_html }},
				"date_published": "{{ .Date.Format "2006-01-02T15:04:05-07:00" }}",
				"url": "{{ .Permalink }}"
				{{- with .Params.categories -}}
				,
				"tags": {{ . | jsonify }}
				{{- end }}
			}
			{{- if ne (add $index 1) $len -}},{{- end -}}
		{{ end }}
	]
}
